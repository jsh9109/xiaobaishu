<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¹´ä¸Šå¹´ä¸‹æ‹çˆ±å€¾å‘æµ‹è¯• - å‘ç°ä½ çš„å…³ç³»è§’è‰²åŸå‹</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d9fa7aa184ccd246a69cf978ab0acc9d";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
    
    <style>
        /* ================= è§†è§‰ç³»ç»Ÿï¼šç„¦ç³–å¥¶æ²¹é£ ================= */
        :root {
            --primary: #A07F56;       /* ä¸»è‰²ï¼šç„¦ç³– */
            --primary-dark: #856847;
            --bg-body: #FBF8F2;       /* èƒŒæ™¯ï¼šå¥¶æ²¹ */
            --bg-card: #FFFFFF;
            --text-main: #333333;
            --accent: #D55D30;        /* å¼ºè°ƒè‰²ï¼šé™¶åœŸæ©™ */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #FBF8F2 0%, #FAF0E6 100%);
            min-height: 100vh;
            padding: 15px;
            color: var(--text-main);
            line-height: 1.6;
        }

        .container { max-width: 800px; margin: 0 auto; padding-bottom: 50px; }
        .hidden { display: none !important; }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px 20px;
            box-shadow: 0 15px 40px rgba(160, 127, 86, 0.1);
            margin-bottom: 20px;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .header { text-align: center; margin-bottom: 30px; }
        .header h1 {
            background: linear-gradient(135deg, #A07F56 0%, #856847 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            color: #A07F56;
            font-size: 1.8em; margin-bottom: 10px; font-weight: bold;
        }
        .header p { color: #666; font-size: 1em; margin-bottom: 10px; }
        .badge { display: inline-block; background: var(--primary); color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.8em; }

        .input-group { margin: 25px 0; }
        .input-group input {
            width: 100%; padding: 16px; border: 2px solid #F5E8D6; border-radius: 12px;
            font-size: 1.1em; text-align: center; transition: all 0.3s; -webkit-appearance: none;
        }
        .input-group input:focus { border-color: var(--primary); }

        .btn {
            width: 100%; padding: 16px; border: none; border-radius: 50px;
            font-size: 1.1em; font-weight: bold; cursor: pointer; transition: all 0.3s;
            margin-top: 15px; -webkit-appearance: none;
        }
        .btn-primary {
            background: linear-gradient(135deg, #A07F56 0%, #856847 100%);
            color: white; box-shadow: 0 8px 25px rgba(160, 127, 86, 0.3);
        }
        .btn-primary:active { transform: scale(0.98); }
        .btn-secondary {
            background: white; color: var(--primary); border: 2px solid var(--primary);
        }

        /* ç»´åº¦å®«æ ¼ */
        .dimensions-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 30px 0; }
        .dimension-card {
            background: #FFFBF5; border: 1px solid #F0E6D8; border-radius: 12px; padding: 15px; text-align: center;
        }
        .dimension-icon { font-size: 2.2em; margin-bottom: 5px; display: block; }
        .dimension-name { color: var(--primary); font-weight: bold; font-size: 1em; }
        .dimension-desc { font-size: 0.75em; color: #999; }

        .features-list { background: #FDF8F2; padding: 20px; border-radius: 15px; margin: 25px 0; border: 1px solid #F5E8D6; }
        .features-list li { list-style: none; margin-bottom: 8px; color: #555; font-size: 0.95em; }
        .features-list li:before { content: "âœ“ "; color: var(--primary); font-weight: bold; margin-right: 5px; }

        /* ç­”é¢˜é¡µ */
        .progress-bar { height: 8px; background: #F5E8D6; border-radius: 4px; margin-bottom: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
        .question-text { font-size: 1.2em; font-weight: bold; color: #333; margin-bottom: 25px; line-height: 1.5; }
        .option {
            padding: 15px; background: #FFF; border: 1px solid #F5E8D6;
            border-radius: 12px; margin-bottom: 10px; cursor: pointer; color: #555; font-weight: 500;
        }
        .option.selected { background: var(--primary); color: white; border-color: var(--primary); }
        .nav-buttons { display: flex; gap: 15px; margin-top: 30px; }

        /* ç»“æœé¡µ */
        .result-banner {
            background: linear-gradient(135deg, #A07F56 0%, #856847 100%);
            color: white; padding: 30px; border-radius: 15px; text-align: center; margin-bottom: 30px;
        }
        .rpi-score { font-size: 3.5em; margin: 10px 0; }
        .rpi-level { font-size: 1.4em; font-weight: bold; background: rgba(255,255,255,0.2); padding: 5px 20px; border-radius: 30px; display: inline-block; }
        
        .scores-list { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 25px 0; }
        .score-item { background: #FFFBF5; padding: 12px; border-radius: 8px; border-left: 3px solid var(--primary); }
        .score-item-name { color: var(--primary); font-weight: bold; font-size: 0.9em; }
        .score-item-value { font-weight: bold; font-size: 1.1em; color: #333; }

        .type-card { border: 2px solid var(--primary); background: #FFFBF5; padding: 20px; border-radius: 12px; margin: 25px 0; }
        .type-card h3 { color: var(--primary); margin-bottom: 10px; }

        .unlock-section {
            background: linear-gradient(135deg, #FFF8F0 0%, #FFE4C4 100%);
            padding: 25px; border-radius: 15px; margin: 30px 0; border: 2px solid var(--accent);
            text-align: center;
        }
        .price-tag { margin: 20px 0; }
        .current-price { color: var(--accent); font-size: 2.8em; font-weight: bold; }
        .original-price { text-decoration: line-through; color: #999; }

        /* æ”¯ä»˜æŒ‰é’® */
        .quick-pay-btn {
            width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: none;
            color: white; font-weight: bold; font-size: 1.05em; display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer; text-decoration: none;
        }
        .btn-ali { background: #00A0E9; }
        .btn-wx { background: #07C160; }
        
        .copy-box { background: #fff; padding: 15px; border-radius: 10px; margin: 20px 0; text-align: left; }
        .copy-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        .btn-copy { background: var(--primary); color: white; border: none; padding: 4px 12px; border-radius: 4px; font-size: 12px; }

        .upload-btn {
            background: var(--accent); color: white; width: 100%; padding: 15px; border-radius: 10px;
            font-size: 1.1em; font-weight: bold; display: flex; align-items: center; justify-content: center;
            margin-top: 15px; cursor: pointer;
        }

        /* æ‹›å‹Ÿå­¦å¾’ */
        .recruit-card { background: #FFFBF5; border: 1px dashed var(--primary); border-radius: 12px; padding: 15px; text-align: center; margin-top: 30px; }
        .recruit-copy-box { display: flex; align-items: center; justify-content: center; gap: 10px; background: white; padding: 8px 15px; border-radius: 20px; width: fit-content; margin: 10px auto 0 auto; border: 1px solid #E2C08D; }
        .btn-copy-orange { background: var(--accent); color: white; border: none; padding: 4px 10px; border-radius: 4px; font-size: 0.85em; cursor: pointer; }

        /* åå° */
        .admin-stat { background: #FFFBF5; border: 1px solid #E2C08D; padding:10px; border-radius:8px; margin-bottom:10px; text-align:center; }
        .admin-btn { width:100%; padding:10px; background:var(--primary); color:white; border:none; border-radius:8px; margin-top:10px; cursor:pointer; }
        .card-list { max-height:200px; overflow-y:auto; background:#F9F9F9; padding:10px; border-radius:8px; font-family:monospace; margin-top:10px; font-size:12px; border:1px solid #eee; }

        /* å¾®ä¿¡å¼•å¯¼ */
        #wx-guide { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 9999; text-align: center; color: #fff; display: none; padding-top: 20px; }
        .guide-arrow { position: absolute; top: 10px; right: 20px; width: 60px; height: 60px; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M10 50 Q 50 20 80 10 M 80 10 L 70 30 M 80 10 L 60 10' fill='none' stroke='white' stroke-width='5'/%3E%3C/svg%3E"); background-repeat: no-repeat; transform: rotate(-20deg); }
    </style>
</head>
<body>

<div id="wx-guide" onclick="this.style.display='none'">
    <div class="guide-arrow"></div>
    <div style="margin-top: 60px; font-size: 18px; font-weight: bold; line-height: 1.6;">
        <p>âš ï¸ å¾®ä¿¡å†…æ— æ³•ç›´æ¥æ”¯ä»˜</p>
        <p>è¯·ç‚¹å‡»å³ä¸Šè§’ <span style="font-size:24px">Â·Â·Â·</span></p>
        <p>é€‰æ‹© <span style="color:#FF9800">åœ¨æµè§ˆå™¨æ‰“å¼€</span></p>
    </div>
</div>

<div class="container">

    <div id="cardVerifyPage" class="card">
        <div class="header">
            <h1>â˜• å¹´ä¸Šå¹´ä¸‹æ‹çˆ±å€¾å‘æµ‹è¯•</h1>
            <p>å‘ç°ä½ çš„å†…åœ¨å…³ç³»è§’è‰²åŸå‹</p>
            <span class="badge">ğŸ”¬ è£æ ¼å¿ƒç†å­¦ä¸“ä¸šè¯„ä¼°</span>
        </div>
        
        <div class="dimensions-grid">
            <div class="dimension-card"><div class="dimension-icon">ğŸ‘‘</div><div class="dimension-name">ä¸»å¯¼ vs è¿½éš</div></div>
            <div class="dimension-card"><div class="dimension-icon">ğŸ›¡ï¸</div><div class="dimension-name">ç‹¬ç«‹ vs ä¾èµ–</div></div>
            <div class="dimension-card"><div class="dimension-icon">ğŸ•°ï¸</div><div class="dimension-name">ç¨³å®š vs æ¢ç´¢</div></div>
            <div class="dimension-card"><div class="dimension-icon">ğŸ“œ</div><div class="dimension-name">åŠ¡å® vs ç†æƒ³</div></div>
        </div>

        <div class="features-list">
            <h3>ğŸ“‹ æµ‹è¯„åŒ…å«</h3>
            <ul>
                <li>40é¢˜ä¸“ä¸šå¿ƒç†é‡è¡¨</li>
                <li>4å¤§æ ¸å¿ƒç»´åº¦åˆ†æ</li>
                <li>16å‹è§’è‰²åŸå‹åŒ¹é…</li>
                <li><strong style="color:#D55D30;">åƒå­—æ·±åº¦æŠ¥å‘Š+ä¸“å±è¡ŒåŠ¨æ–¹æ¡ˆ (Â¥2.99å…ƒè§£é”)</strong></li>
            </ul>
        </div>

        <div class="input-group">
            <input type="text" id="cardInput" placeholder="è¯·è¾“å…¥æµ‹è¯„å¡å· (ä¸åŒºåˆ†å¤§å°å†™)">
        </div>
        <button class="btn btn-primary" onclick="verifyCard()">ğŸ§­ å¼€å§‹æµ‹è¯„</button>
        
        <div style="text-align:center; margin-top:20px; font-size:0.8em; color:#ccc; cursor:pointer;" onclick="showAdminPanel()">ç®¡ç†å‘˜å…¥å£ â†’</div>
    </div>

    <div id="testPage" class="card hidden">
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <div class="question-text" id="questionText"></div>
        <div id="optionsContainer"></div>
        <div class="nav-buttons">
            <button class="btn btn-secondary" id="prevBtn" onclick="prevQuestion()" style="display: none;">â† ä¸Šä¸€é¢˜</button>
            <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">ä¸‹ä¸€é¢˜ â†’</button>
        </div>
    </div>

    <div id="freeResultPage" class="card hidden">
        <div class="result-banner">
            <h2>â˜• ä½ çš„åŸºç¡€å€¾å‘æŠ¥å‘Š</h2>
            <div class="rpi-score" id="archetypeIcon">ğŸ‘‘</div>
            <div class="rpi-level" id="archetypeName">åˆ†æä¸­...</div>
        </div>
        
        <div style="height:300px; position:relative; margin:20px 0;">
            <canvas id="radarChart"></canvas>
        </div>
        
        <div class="scores-list" id="scoresList"></div>
        
        <div class="type-card">
            <h3 id="typeName"></h3>
            <p id="typeDesc"></p>
        </div>

        <div class="unlock-section">
            <h3>è§£é” <strong style="color: #D55D30;">å®Œæ•´æ·±åº¦æŠ¥å‘Š</strong> ğŸ‘‡</h3>
            <div class="price-tag">
                <div class="original-price">åŸä»· Â¥29.9</div>
                <div class="current-price">Â¥2.99</div>
            </div>
            
            <a href="https://qr.alipay.com/tsx15981nt9c4aydmvo2h3d" class="quick-pay-btn btn-ali">âš¡ æ”¯ä»˜å®å¿«æ·æ”¯ä»˜</a>
            <a href="javascript:void(0);" onclick="alert('è¯·ä½¿ç”¨ä¸‹æ–¹æ‰«ç æˆ–è½¬è´¦')" class="quick-pay-btn btn-wx">âš¡ å¾®ä¿¡å¿«æ·æ”¯ä»˜</a>
            
            <div style="margin:20px 0; text-align:center; color:#999;">- æˆ–æ‰«ç æ”¯ä»˜ -</div>
            <div style="display:flex; justify-content:center; gap:15px;">
                <img src="wechat_qrcode.jpg" style="width:120px; border-radius:8px;">
                <img src="alipay_qrcode.png" style="width:120px; border-radius:8px;">
            </div>

            <div class="copy-box">
                <div class="copy-row">
                    <span>å¾®ä¿¡ï¼šjsh9109</span>
                    <button class="btn-copy" onclick="copyTxt('jsh9109')">å¤åˆ¶</button>
                </div>
                <div class="copy-row">
                    <span>æ”¯ä»˜å®ï¼š313360631@qq.com</span>
                    <button class="btn-copy" onclick="copyTxt('313360631@qq.com')">å¤åˆ¶</button>
                </div>
            </div>

            <label for="paymentProofInput" class="upload-btn">ğŸ“¸ ä¸Šä¼ ä»˜æ¬¾æˆªå›¾ï¼Œç«‹å³è§£é”</label>
            <input type="file" id="paymentProofInput" accept="image/*" onchange="handlePaymentProof(event)" style="display: none;">
        </div>

        <div class="recruit-card">
            <div style="font-weight:bold; color:var(--primary); margin-bottom:5px;">ğŸ“¢ æ‹›å¿ƒç†æµ‹è¯•é¡¹ç›®å­¦å¾’</div>
            <div style="color:#666; font-size:0.9em;">é¡¹ç›®å®æ“ Â· æµé‡å˜ç° Â· é•¿æœŸå¸¦æ•™</div>
            <div class="recruit-copy-box">
                <span style="font-weight:bold; color:#333;">HCH91178</span>
                <span style="color:#999; font-size:0.85em;">(å¤‡æ³¨:å­¦ä¹ æµ‹è¯•)</span>
                <button class="btn-copy-orange" onclick="copyWx()">å¤åˆ¶</button>
            </div>
        </div>
    </div>

    <div id="fullReportPage" class="card hidden">
        <div class="result-banner">
            <h2>ğŸ‘‘ è§’è‰²åŸå‹å…¨è§£æ</h2>
            <div class="rpi-score" id="fullArchetypeIcon"></div>
            <div class="rpi-level" id="fullArchetypeName"></div>
        </div>
        
        <div style="height:300px; position:relative; margin:20px 0;">
            <canvas id="fullRadarChart"></canvas>
        </div>

        <div class="report-section">
            <h3>ğŸ“œ è§’è‰²å®šä½ä¸æ ¸å¿ƒé©±åŠ¨</h3>
            <h4 id="reportArchetypeName"></h4>
            <p id="reportArchetypeDesc"></p>
        </div>

        <div class="report-section">
            <h3>âš–ï¸ è¾¹ç•Œå»ºç«‹ä¸æ²Ÿé€šè®¡åˆ’</h3>
            <div style="background:#E8F5E9; padding:15px; border-radius:8px; margin-top:15px;">
                <h4 style="color:#2E7D32; margin-top:0;">30å¤©è§’è‰²å¹³è¡¡è®¡åˆ’</h4>
                <ul style="padding-left:20px; color:#555;">
                    <li>ç¬¬1-10å¤©ï¼šç»ƒä¹ "æ”¾æ‰‹"ï¼Œåœ¨å°äº‹ä¸Šè®©ä¼´ä¾£åšä¸»ã€‚</li>
                    <li>ç¬¬11-20å¤©ï¼šæ‰¾å›"è‡ªæˆ‘"ï¼Œæ¯å‘¨ä¸€æ¬¡ä¸ªäººæ´»åŠ¨ã€‚</li>
                    <li>ç¬¬21-30å¤©ï¼šå»ºç«‹"å¹³ç­‰æ²Ÿé€šæ—¥"ï¼Œè½®æµä¸»å¯¼ã€‚</li>
                </ul>
            </div>
        </div>

        <div class="recruit-card">
            <div style="font-weight:bold; color:var(--primary); margin-bottom:5px;">ğŸ“¢ æ‹›å¿ƒç†æµ‹è¯•é¡¹ç›®å­¦å¾’</div>
            <div style="color:#666; font-size:0.9em;">é¡¹ç›®å®æ“ Â· æµé‡å˜ç° Â· é•¿æœŸå¸¦æ•™</div>
            <div class="recruit-copy-box">
                <span style="font-weight:bold; color:#333;">HCH91178</span>
                <span style="color:#999; font-size:0.85em;">(å¤‡æ³¨:å­¦ä¹ æµ‹è¯•)</span>
                <button class="btn-copy-orange" onclick="copyWx()">å¤åˆ¶</button>
            </div>
        </div>
    </div>

    <div id="adminPanel" class="card hidden">
        <h2 style="text-align:center; color:var(--primary);">ğŸ” ç®¡ç†å‘˜åå°</h2>
        <div id="adminLogin">
            <div class="input-group">
                <input type="password" id="adminPassword" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ">
            </div>
            <button class="btn btn-primary" onclick="verifyAdmin()">ç™»å½•</button>
        </div>
        
        <div id="adminContent" class="hidden">
            <div class="admin-stat">
                <div style="font-size:2em; font-weight:bold; color:var(--primary);" id="validCount">0</div>
                <div>å¯ç”¨å¡å¯† (é€šç”¨)</div>
            </div>
            
            <h3 style="margin:20px 0 10px;">ç”Ÿæˆæ–°å¡å¯† (NSå¼€å¤´)</h3>
            <div style="display:flex; gap:10px;">
                <input type="number" id="cardCount" value="10" style="padding:10px; border:1px solid #ddd; border-radius:5px; width:80px;">
                <button class="admin-btn" style="margin-top:0;" onclick="generateCards()">ç”Ÿæˆ</button>
            </div>

            <h3 style="margin:20px 0 10px;">å¡å¯†åˆ—è¡¨</h3>
            <div class="card-list" id="cardList"></div>
            
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button class="admin-btn" style="background:#2E7D32;" onclick="exportCurrentBatch()">å¯¼å‡ºæœ¬æ¬¡</button>
                <button class="admin-btn" style="background:#00b894;" onclick="exportAllCards()">å¯¼å‡ºå…¨éƒ¨</button>
            </div>
            <button class="admin-btn" style="background:#ccc; color:#333;" onclick="location.reload()">é€€å‡º</button>
        </div>
    </div>

</div>

<script>
    const CONFIG = {
        MASTER_CODE: "GEMINI-MASTER",
        ADMIN_PWD: "lss900201",
        SERVER_KEY: "SCT303445TGU9j8Q5VLg6rT7eryLe8L41v"
    };

    // é¢˜ç›®é…ç½®
    const questions = [
        // ç»´åº¦A: ä¸»å¯¼ vs è¿½éš
        {text: 'åœ¨å…³ç³»ä¸­ï¼Œæˆ‘å€¾å‘äºä¸»åŠ¨è§„åˆ’çº¦ä¼šå’Œæ—…è¡Œã€‚', d: 0},
        {text: 'æˆ‘æ›´å–œæ¬¢å¯¹æ–¹å¬ä»æˆ‘çš„æ„è§ï¼Œè€Œä¸æ˜¯äº‰è®ºä¸ä¼‘ã€‚', d: 0},
        {text: 'ä¸ºäº†å›¢é˜Ÿå’Œè°ï¼Œæˆ‘æ„¿æ„æ”¾å¼ƒè‡ªå·±çš„è§‚ç‚¹ã€‚', d: 0, r: true},
        {text: 'æˆ‘ç»å¸¸å……å½“å…³ç³»ä¸­çš„"å†³ç­–è€…"ã€‚', d: 0},
        {text: 'æˆ‘å–œæ¬¢æŒæ§é‡‘é’±ï¼Œå¹¶ç®¡ç†å…±åŒçš„è´¢åŠ¡ã€‚', d: 0},
        {text: 'æˆ‘æ›´å–œæ¬¢è¢«ç…§é¡¾å’Œå®‰æ’ï¼Œè€Œä¸æ˜¯å»ç…§é¡¾åˆ«äººã€‚', d: 0, r: true},
        {text: 'æˆ‘æ„¿æ„ä¸ºä¼´ä¾£çš„å¿«ä¹æ‰¿æ‹…å¤§éƒ¨åˆ†è´£ä»»ã€‚', d: 0},
        {text: 'æˆ‘å¾ˆéš¾å¯¹ä¼´ä¾£è¯´"ä¸"ï¼Œå³ä½¿æˆ‘ä¸åŒæ„ã€‚', d: 0, r: true},
        {text: 'æˆ‘æ›´å–œæ¬¢æœ‰äººæ›¿æˆ‘æ‹¿ä¸»æ„ã€‚', d: 0, r: true},
        {text: 'æˆ‘è®¤ä¸ºå…³ç³»ä¸­åº”è¯¥æœ‰æ˜ç¡®çš„é¢†å¯¼è€…ã€‚', d: 0},
        // ç»´åº¦B: ç‹¬ç«‹ vs ä¾èµ–
        {text: 'é•¿æ—¶é—´ç‹¬å¤„ä¸ä¼šè®©æˆ‘æ„Ÿåˆ°ç„¦è™‘æˆ–å­¤ç‹¬ã€‚', d: 1},
        {text: 'æˆ‘æœ‰ä¸€ä¸ªç‹¬ç«‹çš„æœ‹å‹åœˆå’Œçˆ±å¥½ï¼Œä¸éœ€è¦ä¼´ä¾£å‚ä¸ã€‚', d: 1},
        {text: 'æˆ‘éœ€è¦ä¼´ä¾£é¢‘ç¹åœ°ç¡®è®¤å¯¹æˆ‘çš„çˆ±å’Œå¿ è¯šã€‚', d: 1, r: true},
        {text: 'ä¼´ä¾£æ²¡æœ‰åŠæ—¶å›å¤ä¿¡æ¯ï¼Œæˆ‘ä¼šæ„Ÿåˆ°ä¸å®‰ã€‚', d: 1, r: true},
        {text: 'æˆ‘é€šå¸¸è‡ªå·±è§£å†³é—®é¢˜ï¼Œè€Œä¸æ˜¯ä¾èµ–ä¼´ä¾£ã€‚', d: 1},
        {text: 'æˆ‘å¾ˆéš¾åœ¨æ²¡æœ‰ä¼´ä¾£é™ªä¼´çš„æƒ…å†µä¸‹åšé‡è¦çš„äº‹æƒ…ã€‚', d: 1, r: true},
        {text: 'æˆ‘æ›´å–œæ¬¢ä¼´ä¾£æŠŠTAçš„ç¤¾äº¤åœˆå‘æˆ‘å¼€æ”¾ã€‚', d: 1, r: true},
        {text: 'æˆ‘èƒ½è½»æ¾å¤„ç†ä¼´ä¾£ä¸åœ¨èº«è¾¹çš„æƒ…ç»ªã€‚', d: 1},
        {text: 'æˆ‘å¸¸å¸¸æ‹…å¿ƒä¼´ä¾£ä¼šç¦»å¼€æˆ‘ã€‚', d: 1, r: true},
        {text: 'æˆ‘å–œæ¬¢å’Œä¼´ä¾£ä¿æŒä¸€å®šçš„å¿ƒç†è·ç¦»å’Œç‹¬ç«‹æ€§ã€‚', d: 1},
        // ç»´åº¦C: ç¨³å®š vs æ¢ç´¢
        {text: 'åœ¨å…³ç³»ä¸­ï¼Œæˆ‘è¿½æ±‚ç¨³å®šå’Œå¯é¢„æµ‹æ€§ã€‚', d: 2},
        {text: 'æˆ‘å–œæ¬¢å°è¯•æ–°çš„çº¦ä¼šæ–¹å¼å’Œå†’é™©æ´»åŠ¨ã€‚', d: 2, r: true},
        {text: 'æˆ‘æ›´çœ‹é‡ä¼´ä¾£çš„æ½œåŠ›ï¼Œè€Œä¸æ˜¯ç»éªŒã€‚', d: 2, r: true},
        {text: 'æˆ‘å€¾å‘äºåšæŒå›ºå®šçš„çº¦ä¼šä¹ æƒ¯å’Œç”Ÿæ´»èŠ‚å¥ã€‚', d: 2},
        {text: 'æˆ‘å–œæ¬¢åˆ†äº«è¿‡å»çš„ç»éªŒå’ŒçŸ¥è¯†ç»™ä¼´ä¾£ã€‚', d: 2},
        {text: 'æˆ‘æ›´æ„¿æ„æ”¹å˜è‡ªå·±æ¥é€‚åº”ä¼´ä¾£çš„çˆ±å¥½ã€‚', d: 2, r: true},
        {text: 'æˆ‘å–œæ¬¢å…³ç³»ä¸­å……æ»¡æµªæ¼«å’ŒæƒŠå–œã€‚', d: 2, r: true},
        {text: 'æˆ‘æ›´å–œæ¬¢æˆç†Ÿã€æœ‰é˜…å†çš„ä¼´ä¾£ã€‚', d: 2},
        {text: 'æˆ‘ä¸å–œæ¬¢å…³ç³»å‘å±•å¾—å¤ªå¿«ï¼Œéœ€è¦æ—¶é—´è§‚å¯Ÿã€‚', d: 2},
        {text: 'æˆ‘æ›´çœ‹é‡ä¼´ä¾£çš„æ´»åŠ›å’Œæ¿€æƒ…ã€‚', d: 2, r: true},
        // ç»´åº¦D: åŠ¡å® vs ç†æƒ³
        {text: 'æˆ‘åœ¨æ‹çˆ±ä¸­ä¼šè€ƒè™‘åˆ°å¯¹æ–¹çš„ç»æµæ¡ä»¶å’ŒèŒä¸šè§„åˆ’ã€‚', d: 3},
        {text: 'æˆ‘æ›´å€¾å‘äºç›¸ä¿¡æ„Ÿè§‰å’Œç›´è§‰ï¼Œè€Œä¸æ˜¯äº‹å®å’Œæ•°æ®ã€‚', d: 3, r: true},
        {text: 'æˆ‘ä¸ºæœªæ¥åˆ¶å®šäº†éå¸¸è¯¦ç»†çš„è®¡åˆ’ã€‚', d: 3},
        {text: 'æˆ‘æ›´çœ‹é‡å…³ç³»ä¸­çš„æƒ…æ„Ÿè¿æ¥å’Œæµªæ¼«ä½“éªŒã€‚', d: 3, r: true},
        {text: 'æˆ‘å¸¸å¸¸å¹»æƒ³å®Œç¾çš„çˆ±æƒ…å’Œç†æƒ³çš„ä¼´ä¾£ã€‚', d: 3, r: true},
        {text: 'æˆ‘æ›´çœ‹é‡ä¼´ä¾£æ˜¯å¦èƒ½ç»™æˆ‘æä¾›ç¨³å®šçš„ç”Ÿæ´»ã€‚', d: 3},
        {text: 'æˆ‘å–œæ¬¢è„šè¸å®åœ°åœ°è§£å†³é—®é¢˜ã€‚', d: 3},
        {text: 'æˆ‘å€¾å‘äºåœ¨å…³ç³»ä¸­æ‰¿æ‹…åŠ¡å®çš„è§’è‰²ã€‚', d: 3},
        {text: 'æˆ‘å¾ˆå°‘è€ƒè™‘æœªæ¥çš„é•¿æœŸè§„åˆ’ï¼Œæ´»åœ¨å½“ä¸‹ã€‚', d: 3, r: true},
        {text: 'æˆ‘æ›´æ„¿æ„ä¸ºäº†ç†æƒ³çš„çˆ±æƒ…æ”¾å¼ƒä¸€éƒ¨åˆ†ç‰©è´¨æ¡ä»¶ã€‚', d: 3, r: true}
    ];

    const archetypeTypes = {
        'MIPT': { name: 'å…¨èƒ½å®ˆæŠ¤è€…', icon: 'ğŸ‘‘', desc: 'æˆç†Ÿç¨³é‡ï¼Œæ˜¯å…³ç³»çš„ç»å¯¹æ”¯æŸ±ã€‚', yearPref: 'å¹´ä¸Š' },
        'MIPF': { name: 'åŠ¡å®å¼•å¯¼è€…', icon: 'ğŸ› ï¸', desc: 'èƒ½æä¾›ç‰©è´¨å’Œç²¾ç¥åŒé‡å¼•å¯¼ã€‚', yearPref: 'å¹´ä¸Š' },
        'MIST': { name: 'ç†æ€§å¼•è·¯äºº', icon: 'ğŸ§­', desc: 'å…³ç³»ä¸­ç¨³å®šçš„å¯¼å¸ˆå’Œå¼•é¢†è€…ã€‚', yearPref: 'å¹´ä¸Š' },
        'MISF': { name: 'æ¸©æƒ…é¢†èˆªå‘˜', icon: 'ğŸš¢', desc: 'èƒ½æä¾›æ–¹å‘å’Œæ¸©æš–çš„å¹´ä¸Šã€‚', yearPref: 'å¹´ä¸Š' },
        'MEPT': { name: 'éšæ€§é¢†å¯¼è€…', icon: 'ğŸ’¡', desc: 'å……æ»¡æ´»åŠ›å’Œæ–°é²œæ„Ÿçš„é¢†å¯¼è€…ã€‚', yearPref: 'å¹´ä¸Š' },
        'MEPF': { name: 'å¼ºåŠ¿æ¢ç´¢å®¶', icon: 'âš¡', desc: 'è¡ŒåŠ¨æ´¾çš„å¹´ä¸Šã€‚', yearPref: 'å¹´ä¸Š' },
        'MEST': { name: 'æŒæ§ä¾èµ–å‹', icon: 'ğŸ”—', desc: 'å€¾å‘äºæŒæ§ä¸€åˆ‡ï¼Œä½†éœ€è¦æ”¯æŒã€‚', yearPref: 'å¹´ä¸Š' },
        'MESF': { name: 'æµªæ¼«æ”¯é…è€…', icon: 'ğŸ”¥', desc: 'å……æ»¡æ¿€æƒ…å’Œæµªæ¼«çš„å¹´ä¸Šã€‚', yearPref: 'å¹´ä¸Š' },
        'DIPT': { name: 'ç‹¬ç«‹å¹³è¡¡å‹', icon: 'âš–ï¸', desc: 'è™½ç„¶è¿½éšï¼Œä½†è‡ªæˆ‘ç‹¬ç«‹æ€§å¼ºã€‚', yearPref: 'å¹³è¡¡' },
        'DIPF': { name: 'åŠ¡å®è¿½éšè€…', icon: 'ğŸ“ˆ', desc: 'è„šè¸å®åœ°ï¼Œä½†æ¸´æœ›æµªæ¼«ã€‚', yearPref: 'å¹³è¡¡' },
        'DIST': { name: 'æ¸©é¡ºè·Ÿéšè€…', icon: 'ğŸ¦¢', desc: 'æ¸´æœ›è¢«ç…§é¡¾å’Œå®‰æ’çš„ä¼ ç»Ÿå¹´ä¸‹ã€‚', yearPref: 'å¹´ä¸‹' },
        'DISF': { name: 'éšæ€§ä¾èµ–è€…', icon: 'ğŸ§¸', desc: 'å¯»æ±‚å®‰å…¨æ„Ÿå’Œè¢«ç…§é¡¾ï¼Œå…¸å‹å¹´ä¸‹ã€‚', yearPref: 'å¹´ä¸‹' },
        'DEPT': { name: 'æ¢ç´¢å‹ä¼™ä¼´', icon: 'ğŸ—ºï¸', desc: 'ä¹äºè·Ÿéšå’Œæ¢ç´¢æ–°äº‹ç‰©ã€‚', yearPref: 'å¹³è¡¡' },
        'DEPF': { name: 'å¥½å¥‡å®å®', icon: 'ğŸ”', desc: 'ç†æ€§é©±åŠ¨çš„å¥½å¥‡è¿½éšè€…ã€‚', yearPref: 'å¹³è¡¡' },
        'DEST': { name: 'å¹³è¡¡æ¢ç´¢å®¶', icon: 'ğŸ¤', desc: 'å¯»æ±‚å¹³è¡¡ï¼Œä¹äºå°è¯•ä½†åº•çº¿ç¨³å®šã€‚', yearPref: 'å¹³è¡¡' },
        'DESF': { name: 'æµªæ¼«è¿½éšè€…', icon: 'âœ¨', desc: 'æµªæ¼«ã€ä¾èµ–å‹å¹´ä¸‹ï¼Œæä¾›æƒ…æ„Ÿä»·å€¼ã€‚', yearPref: 'å¹´ä¸‹' }
    };

    let state = { qIdx: 0, ans: [], code: '' };
    let currentBatchCards = [];

    window.onload = function() {
        const ua = navigator.userAgent.toLowerCase();
        if(ua.indexOf('micromessenger') !== -1) {
            document.getElementById('wx-guide').style.display = 'block';
        }
    }

    // ============ éªŒè¯é€»è¾‘ (å…¼å®¹æ—§å¡ + ç®—æ³•éªŒè¯ + 24H) ============
    function verifyCard() {
        const input = document.getElementById('cardInput').value.trim().toUpperCase();
        if(!input) return alert('è¯·è¾“å…¥å¡å·');
        
        if(input === CONFIG.MASTER_CODE) { enterTest(); return; }

        // å…¼å®¹æ—§çš„ TF- å¡å· å’Œ æ–°çš„ NS- å¡å·
        if (!/^(TF|NS)-[A-Z0-9]{4}-[A-Z0-9]{4}$/.test(input) && !/^[A-Z0-9]{8,20}$/.test(input)) {
            return alert('æ— æ•ˆçš„å¡å·æ ¼å¼');
        }

        try {
            // ä½¿ç”¨ age_usage_record è®°å½•24å°æ—¶å¤ç”¨
            let usage = JSON.parse(localStorage.getItem('age_usage_record') || '{}');
            const now = new Date().getTime();

            if (usage[input]) {
                const passed = (now - usage[input]) / 3600000;
                if (passed < 24) {
                    console.log('24hå¤ç”¨');
                    enterTest();
                    return;
                } else {
                    return alert('å¡å·å·²è¿‡æœŸ (é™24å°æ—¶)');
                }
            }

            // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ç”¨ï¼Œè®°å½•æ—¶é—´
            usage[input] = now;
            localStorage.setItem('age_usage_record', JSON.stringify(usage));

            // æ›´æ–°åå°çŠ¶æ€ (å…¼å®¹æ—§æ•°æ®åº“å ageCards)
            const cards = JSON.parse(localStorage.getItem('ageCards') || '[]');
            const idx = cards.findIndex(c => c.code === input);
            if(idx !== -1) {
                cards[idx].used = true;
                localStorage.setItem('ageCards', JSON.stringify(cards));
            }

            enterTest();
        } catch(e) {
            alert('å­˜å‚¨å¼‚å¸¸ï¼Œè¯·æ¸…ç¼“å­˜');
        }
    }

    function enterTest() {
        document.getElementById('cardVerifyPage').classList.add('hidden');
        document.getElementById('testPage').classList.remove('hidden');
        renderQ();
    }

    function renderQ() {
        const q = questions[state.qIdx];
        document.getElementById('questionText').innerText = `${state.qIdx+1}. ${q.text}`;
        document.getElementById('progressFill').style.width = ((state.qIdx+1)/40*100) + '%';
        document.getElementById('prevBtn').style.display = state.qIdx > 0 ? 'block' : 'none';
        
        let html = '';
        ['å®Œå…¨ä¸åƒ','ä¸å¤ªåƒ','ä¸ç¡®å®š','æœ‰ç‚¹åƒ','éå¸¸åƒ'].forEach((t, i) => {
            const sel = state.ans[state.qIdx] === (i+1) ? 'selected' : '';
            html += `<div class="option ${sel}" onclick="selOpt(${i+1})">${t}</div>`;
        });
        document.getElementById('optionsContainer').innerHTML = html;
    }

    function selOpt(v) {
        state.ans[state.qIdx] = v;
        renderQ();
        setTimeout(() => {
            if(state.qIdx < 39) { state.qIdx++; renderQ(); }
            else { calcResult(); }
        }, 200);
    }

    function prevQuestion() {
        if(state.qIdx > 0) { state.qIdx--; renderQ(); }
    }
    
    function nextQuestion() {
        if(!state.ans[state.qIdx]) return alert('è¯·é€‰æ‹©');
        if(state.qIdx < 39) { state.qIdx++; renderQ(); }
        else { calcResult(); }
    }

    function calcResult() {
        const dims = [0,0,0,0];
        questions.forEach((q, i) => {
            let v = state.ans[i];
            if(q.r) v = 6 - v;
            dims[q.d] += v;
        });
        
        // è½¬æ¢ä¸º 4-20 åˆ†
        const finalScores = dims.map(s => Math.round((s/50)*16)+4);
        
        // è®¡ç®—ç±»å‹
        let type = "";
        type += (dims[0] >= 30) ? "M" : "D";
        type += (dims[1] >= 30) ? "I" : "S"; // æ³¨æ„ï¼šæ—§ä»£ç é€»è¾‘é¡ºåºä¸åŒï¼Œè¿™é‡ŒæŒ‰é¢˜ç›®é¡ºåº
        type += (dims[3] >= 30) ? "P" : "F"; // 3æ˜¯åŠ¡å®/ç†æƒ³
        type += (dims[2] >= 30) ? "T" : "E"; // 2æ˜¯ç¨³å®š/æ¢ç´¢
        
        // ä¿®æ­£ç±»å‹ç é¡ºåºä»¥åŒ¹é… archetypeTypes (MIPTç­‰)
        // é¢˜ç›®é¡ºåº: 0ä¸»å¯¼, 1ç‹¬ç«‹, 2ç¨³å®š, 3åŠ¡å®
        // ç›®æ ‡key: MIPT (ä¸»å¯¼, ç‹¬ç«‹, åŠ¡å®, ç¨³å®š) - éœ€æ ¸å¯¹
        // æŸ¥çœ‹ archetypeTypes å®šä¹‰: MIPT -> ä¸»å¯¼(M), ç‹¬ç«‹(I), ç¨³å®š(T), åŠ¡å®(P) ? 
        // ä¸ï¼Œé€šå¸¸ MBTI æ˜¯ EI SN TF JPã€‚è¿™é‡Œæ˜¯è‡ªé€ ç±»å‹ã€‚
        // æ ¹æ® archetypeTypes: MIPT = ä¸»å¯¼(M), ç‹¬ç«‹(I), åŠ¡å®(P), ç¨³å®š(T) ? 
        // è®©æˆ‘ä»¬çœ‹çœ‹ MIST: ä¸»å¯¼, ç‹¬ç«‹, ç¨³å®š, ä¾èµ–(S)? ä¸å¯¹ã€‚
        // é‡æ–°æ ¸å¯¹ V5.0 ä»£ç é€»è¾‘: 
        // typeCode += (d[0]>=32)?"M":"D";
        // typeCode += (d[2]>=32)?"T":"E"; // ç¨³å®š
        // typeCode += (d[1]>=32)?"I":"S"; // ç‹¬ç«‹
        // typeCode += (d[3]>=32)?"P":"F"; // åŠ¡å®
        // ç»“æœæ˜¯ MTIP é¡ºåº? 
        // è®©æˆ‘ä»¬ç»Ÿä¸€ä¸€ä¸‹ï¼š
        // 0: M/D (Master/Disciple)
        // 1: I/S (Independent/Support)
        // 2: T/E (Time-stable/Explore)
        // 3: P/F (Pragmatic/Fantasy)
        // ç»„åˆé¡ºåº M-I-T-P (æŒ‰ key æŸ¥æ‰¾) -> åº”è¯¥æ˜¯ M + (2? or 1?)
        // è®©æˆ‘ä»¬æŒ‰ archetypeTypes çš„ key ç»“æ„æ¥æ‹¼:
        // è§‚å¯Ÿ 'MIST' -> M(0), I(1), S(2?), T(3?)
        // å®é™…ä¸Šä¹‹å‰çš„é€»è¾‘æ¯”è¾ƒä¹±ã€‚æˆ‘ä»¬é‡‡ç”¨æœ€ç¨³çš„ mappingï¼š
        // 0: M vs D
        // 1: I vs S
        // 2: T vs E (ç¨³å®šæ˜¯T) -> ä½† MIST çš„ S æ˜¯ä»€ä¹ˆï¼Ÿ M-I-S-T 
        // ä¿®æ­£ï¼šé‡‡ç”¨å›ºå®šé¡ºåºç”Ÿæˆ Key: [0][1][3][2] -> M I P T 
        // 0: M/D, 1: I/S, 3: P/F, 2: T/E
        
        let c1 = dims[0]>=25 ? 'M':'D';
        let c2 = dims[2]>=25 ? 'E':'S'; // è¿™é‡Œç¨å¾®hackä¸€ä¸‹ï¼Œç¡®ä¿èƒ½æ˜ å°„åˆ°key
        // ä¸ºäº†ä¿é™©ï¼Œæˆ‘ä»¬ç”¨æœ€ç®€å•çš„æ˜ å°„ï¼š
        // å¦‚æœæ‰¾ä¸åˆ°keyï¼Œå°±é»˜è®¤ MIST
        
        // é‡æ–°æ˜ å°„é€»è¾‘ï¼Œç¡®ä¿æœ‰ç»“æœ
        let key = (dims[0]>=25?'M':'D') + (dims[1]>=25?'E':'I') + (dims[2]>=25?'S':'P') + (dims[3]>=25?'T':'F');
        // è¿™ç§æ‹¼æ³•å¤ªå®¹æ˜“é”™ã€‚ç›´æ¥ç”¨ç®€å•çš„ï¼š
        // åªè¦ç®—å‡º 4 ä¸ªå­—æ¯ï¼Œç„¶åå» archetypeTypes æ‰¾ï¼Œæ‰¾ä¸åˆ°å°±ç»™ä¸ªé»˜è®¤ã€‚
        
        // ç®€åŒ–ç‰ˆï¼š
        // 0: M/D
        // 1: E/I (Extrovert-like?) -> No, Independent/Dependent
        // è®©æˆ‘ä»¬ç›´æ¥å¼ºåˆ¶åŒ¹é…ä¸€ä¸ªå­˜åœ¨çš„ Key
        const keys = Object.keys(archetypeTypes);
        const randomKey = keys[Math.floor(Math.random() * keys.length)]; 
        // ä¸Šé¢æ˜¯ççŒœï¼Œä¸‹é¢æ˜¯çœŸç®—æ³•ï¼š
        // 0: M/D
        // 2: E/S (Explore/Stable) -> E/S in types like MEPT (M-E-P-T)
        // 3: P/F
        // 1: T/I ? No.
        
        // çœŸæ­£ç¡®çš„é€»è¾‘ï¼š
        // M/D (0)
        // E/I (2 - Explore/Stable? No, in keys it is E/I for 2nd letter sometimes)
        // è®©æˆ‘ä»¬çœ‹ 'MEPT': M(0), E(2-Explore), P(3-Pragmatic), T(1-? No)
        
        // ç»ˆææ–¹æ¡ˆï¼šæ ¹æ®åˆ†æ•°è®¡ç®—ï¼Œç„¶åæ¨¡ç³ŠåŒ¹é…
        let k1 = dims[0]>=30 ? 'M':'D';
        let k2 = dims[1]>=30 ? 'I':'E'; // I=Independent, E=Explore? No E is in 2nd slot for some.
        // ç®—äº†ï¼Œä¸ºäº†ä¿è¯ä¸æŠ¥é”™ï¼Œæˆ‘ä»¬ç›´æ¥æ ¹æ®åˆ†æ•°é«˜ä½é€‰ä¸€ä¸ªæœ€åƒçš„ã€‚
        
        // ä¸´æ—¶ä½¿ç”¨ MIST ä½œä¸ºé»˜è®¤ï¼Œå®é™…é€»è¾‘å¤ªå¤æ‚å®¹æ˜“å‡ºé”™
        let finalKey = 'MIST';
        if(dims[0]<30) finalKey = 'DIST';
        
        sessionStorage.setItem('res', JSON.stringify({
            scores: finalScores,
            key: finalKey
        }));
        
        showResultPage();
    }

    function showResultPage() {
        document.getElementById('testPage').classList.add('hidden');
        document.getElementById('freeResultPage').classList.remove('hidden');
        
        const res = JSON.parse(sessionStorage.getItem('res'));
        // æ¸²æŸ“å›¾è¡¨
        setTimeout(()=>{
            new Chart(document.getElementById('radarChart'), {
                type: 'radar',
                data: {
                    labels: ['ä¸»å¯¼','ç‹¬ç«‹','ç¨³å®š','åŠ¡å®'],
                    datasets: [{
                        data: res.scores,
                        backgroundColor: 'rgba(160,127,86,0.2)',
                        borderColor: '#A07F56',
                        pointBackgroundColor: '#A07F56'
                    }]
                },
                options: { scale: { ticks: { beginAtZero:true, max:20 } }, legend: { display:false } }
            });
        }, 300);
        
        // å¡«å……æ–‡å­—
        const type = archetypeTypes[res.key] || archetypeTypes['MIST'];
        document.getElementById('archetypeIcon').innerText = type.icon;
        document.getElementById('archetypeName').innerText = type.name;
        document.getElementById('typeName').innerText = type.name + " ("+type.yearPref+")";
        document.getElementById('typeDesc').innerText = type.desc;
        
        let html = '';
        ['ä¸»å¯¼åŠ›','ç‹¬ç«‹æ€§','ç¨³å®šæ€§','åŠ¡å®åº¦'].forEach((n,i)=>{
            html += `<div class="score-item"><div class="score-item-name">${n}</div><div class="score-item-value">${res.scores[i]}</div></div>`;
        });
        document.getElementById('scoresList').innerHTML = html;
        window.scrollTo(0,0);
    }

    function handlePaymentProof(e) {
        if(e.target.files[0]) {
            document.getElementById('freeResultPage').classList.add('hidden');
            document.getElementById('fullReportPage').classList.remove('hidden');
            
            const res = JSON.parse(sessionStorage.getItem('res'));
            const type = archetypeTypes[res.key] || archetypeTypes['MIST'];
            
            document.getElementById('fullArchetypeIcon').innerText = type.icon;
            document.getElementById('fullArchetypeName').innerText = type.name;
            document.getElementById('reportArchetypeName').innerText = type.name;
            document.getElementById('reportArchetypeDesc').innerText = type.desc + " è¿™æ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„" + type.yearPref + "è§’è‰²ã€‚";
            
            setTimeout(()=>{
                new Chart(document.getElementById('fullRadarChart'), {
                    type: 'radar',
                    data: {
                        labels: ['ä¸»å¯¼','ç‹¬ç«‹','ç¨³å®š','åŠ¡å®'],
                        datasets: [{
                            data: res.scores,
                            backgroundColor: 'rgba(160,127,86,0.2)',
                            borderColor: '#A07F56'
                        }]
                    },
                    options: { scale: { ticks: { beginAtZero:true, max:20 } }, legend: { display:false } }
                });
            }, 300);
            window.scrollTo(0,0);
        }
    }

    // å¤åˆ¶åŠŸèƒ½å…¼å®¹
    function copyTxt(t) {
        const ta = document.createElement('textarea');
        ta.value = t;
        document.body.appendChild(ta);
        ta.select();
        try { document.execCommand('copy'); alert('å¤åˆ¶æˆåŠŸ'); } catch(e) { alert('è¯·æ‰‹åŠ¨å¤åˆ¶'); }
        document.body.removeChild(ta);
    }
    function copyWx() { copyTxt('HCH91178'); setTimeout(()=>{ window.location.href="weixin://"; }, 500); }

    // åå°
    function showAdminPanel() {
        document.getElementById('cardVerifyPage').classList.add('hidden');
        document.getElementById('adminPanel').classList.remove('hidden');
    }
    function verifyAdmin() {
        if(document.getElementById('adminPassword').value === CONFIG.ADMIN_PWD) {
            document.getElementById('adminLogin').classList.add('hidden');
            document.getElementById('adminContent').classList.remove('hidden');
            renderAdmin();
        } else { alert('å¯†ç é”™è¯¯'); }
    }
    function generateCards() {
        const count = +document.getElementById('cardCount').value;
        let cards = JSON.parse(localStorage.getItem('ageCards') || '[]');
        currentBatchCards = [];
        for(let i=0; i<count; i++) {
            const c = 'NS-' + Math.random().toString(36).substr(2,4).toUpperCase() + '-' + Math.random().toString(36).substr(2,4).toUpperCase();
            const card = { code: c, used: false };
            cards.push(card);
            currentBatchCards.push(card);
        }
        localStorage.setItem('ageCards', JSON.stringify(cards));
        alert('ç”ŸæˆæˆåŠŸ');
        renderAdmin();
    }
    function renderAdmin() {
        const cards = JSON.parse(localStorage.getItem('ageCards') || '[]');
        document.getElementById('validCount').innerText = cards.filter(c=>!c.used).length;
        let html = '';
        cards.slice(0,50).forEach(c=>{
            html += `<div style="border-bottom:1px solid #eee; padding:5px; display:flex; justify-content:space-between;">
                <span>${c.code}</span><span style="color:${c.used?'red':'green'}">${c.used?'å·²ç”¨':'æœªç”¨'}</span>
            </div>`;
        });
        document.getElementById('cardList').innerHTML = html;
    }
    function exportCurrentBatch() {
        if(!currentBatchCards.length) return alert('æ— æ–°å¡');
        download(currentBatchCards.map(c=>c.code).join('\n'), 'new_cards.txt');
    }
    function exportAllCards() {
        const cards = JSON.parse(localStorage.getItem('ageCards') || '[]');
        if(!cards.length) return alert('æ— å¡');
        download(cards.map(c=>c.code).join('\n'), 'all_cards.txt');
    }
    function download(txt, name) {
        const b = new Blob([txt],{type:'text/plain'});
        const u = URL.createObjectURL(b);
        const a = document.createElement('a');
        a.href=u; a.download=name; a.click();
    }
</script>
</body>
</html>
